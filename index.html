<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Меню</title>

<style>
body{
  margin:0;
  background:#f5f5f5;
  font-family:sans-serif
}
#pdf{
  max-width:900px;
  margin:auto;
  padding:8px
}
canvas{
  width:100%;
  display:block;
  margin-bottom:12px;
  background:#fff;
  box-shadow:0 2px 6px rgba(0,0,0,.08)
}
</style>
</head>

<body>
<div id="pdf"></div>

<script defer src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
const URL = 'menu.pdf';
const container = document.getElementById('pdf');

pdfjsLib.GlobalWorkerOptions.workerSrc =
  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

(async () => {
  const pdf = await pdfjsLib.getDocument(URL).promise;
  const observer = new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        renderPage(+e.target.dataset.page);
        observer.unobserve(e.target);
      }
    });
  },{rootMargin:'300px'});

  for(let i=1;i<=pdf.numPages;i++){
    const holder=document.createElement('div');
    holder.dataset.page=i;
    container.appendChild(holder);
    observer.observe(holder);
  }

  async function renderPage(n){
    const page=await pdf.getPage(n);
    const viewport=page.getViewport({scale:1});
    const scale=Math.min(container.clientWidth/viewport.width,1.5);

    const canvas=document.createElement('canvas');
    const ctx=canvas.getContext('2d');

    const v=page.getViewport({scale});
    canvas.width=v.width;
    canvas.height=v.height;

    await page.render({canvasContext:ctx,viewport:v}).promise;
    container.querySelector(`[data-page="${n}"]`).replaceWith(canvas);
  }
})();
</script>
</body>
</html>
